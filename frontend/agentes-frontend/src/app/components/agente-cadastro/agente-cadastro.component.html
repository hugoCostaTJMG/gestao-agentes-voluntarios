<div class="container-fluid py-4 agente-cadastro">
  <div class="row g-3 g-lg-4">
    <div class="col-12">
      <div class="card agente-cadastro__card h-100">
        <div class="card-header d-flex flex-column flex-md-row align-items-start align-items-md-center gap-2 gap-md-3 justify-content-md-between">
          <h5 class="mb-0">
            <i class="fas" [ngClass]="isEditMode ? 'fa-user-edit' : 'fa-user-plus'"></i>
            <span class="ms-2">{{ isEditMode ? 'Alterar Dados do Agente' : 'Cadastrar Agente Voluntário' }}</span>
          </h5>
        </div>
        <div class="card-body">
          
          <form class="agente-cadastro__form" [formGroup]="agenteForm" (ngSubmit)="salvarAgente()" novalidate>
            
            <!-- Dados Pessoais -->
            <div class="row g-3 g-lg-4 mb-4">
              <div class="col-12">
                <h6 class=" border-bottom pb-2">
                  <i class="fas fa-user me-2"></i>
                  Dados Pessoais
                </h6>
              </div>
              
              <div class="col-12 col-lg-8">
                <app-text-input label="Nome Completo *" placeholder="Digite o nome completo" formControlName="nomeCompleto" fluid="true"></app-text-input>
              </div>
              
              <div class="col-12 col-lg-4">
                <label for="cpf" class="form-label">CPF *</label>
                <input type="text" class="form-control" id="cpf" 
                       formControlName="cpf" placeholder="000.000.000-00" 
                       cpfMask>
                <div class="invalid-feedback" 
                     *ngIf="agenteForm.get('cpf')?.invalid && agenteForm.get('cpf')?.touched">
                  <span *ngIf="agenteForm.get('cpf')?.errors?.['required']">CPF é obrigatório</span>
                  <span *ngIf="agenteForm.get('cpf')?.errors?.['cpfInvalido']">CPF inválido</span>
                </div>
              </div>

              <!-- Foto -->
              <div class="col-12 col-md-6 col-lg-4">
                <label for="foto" class="form-label">Foto</label>
                <input type="file" class="form-control" id="foto" 
                       (change)="onFileSelected($event)" accept="image/*">
                <div class="form-text">Formatos aceitos: JPG, PNG (máx. 2MB)</div>
              </div>

              <!-- Data de Nascimento -->
              <div class="col-12 col-sm-6 col-lg-4">
                <label for="dataNascimento" class="form-label">Data de Nascimento</label>
                <input type="date" class="form-control" id="dataNascimento" 
                       formControlName="dataNascimento">
              </div>

              <!-- Nacionalidade -->
              <div class="col-12 col-sm-6 col-lg-4">
                <app-text-input label="Nacionalidade" placeholder="Ex: Brasileira" formControlName="nacionalidade" fluid="true"></app-text-input>
              </div>
              
              <div class="col-12 col-md-6">
                <label for="telefone" class="form-label">Telefone *</label>
                <input type="text" class="form-control" id="telefone" 
                       formControlName="telefone" placeholder="(00) 00000-0000" phoneMask>
                <div class="invalid-feedback" 
                     *ngIf="agenteForm.get('telefone')?.invalid && agenteForm.get('telefone')?.touched">
                  <span *ngIf="agenteForm.get('telefone')?.errors?.['required']">Telefone é obrigatório</span>
                  <span *ngIf="agenteForm.get('telefone')?.errors?.['telefoneInvalido']">Telefone inválido</span>
                </div>
              </div>
              
              <div class="col-12 col-md-6">
                <app-text-input label="E-mail *" placeholder="email@exemplo.com" formControlName="email" fluid="true"></app-text-input>
              </div>
            </div>

            <!-- Documentação -->
            <div class="row g-3 g-lg-4 mb-4">
              <div class="col-12">
                <h6 class=" border-bottom pb-2">
                  <i class="fas fa-id-card me-2"></i>
                  Documentação
                </h6>
              </div>

              <div class="col-12 col-md-6 col-lg-4">
                <label for="numeroCarteiraIdentidade" class="form-label">Número Carteira de Identidade (RG)</label>
                <input type="text" class="form-control" id="numeroCarteiraIdentidade" 
                       formControlName="numeroCarteiraIdentidade" placeholder="00.000.000-0" rgMask>
              </div>

              <div class="col-12 col-sm-6 col-lg-4">
                <label for="dataExpedicaoCI" class="form-label">Data Expedição CI</label>
                <input type="date" class="form-control" id="dataExpedicaoCI" 
                       formControlName="dataExpedicaoCI">
              </div>

              <div class="col-12 col-sm-6 col-lg-4">
                <label for="uf" class="form-label">UF</label>
                <select class="form-select" id="uf" formControlName="uf">
                  <option value="">Selecione o estado</option>
                  <option *ngFor="let estado of estados" [value]="estado.sigla">
                    {{ estado.sigla }} - {{ estado.nome }}
                  </option>
                </select>
              </div>

              <div class="col-12 col-md-6">
                <app-text-input label="Naturalidade" placeholder="Ex: Belo Horizonte" formControlName="naturalidade" fluid="true"></app-text-input>
              </div>
            </div>

            <!-- Filiação -->
            <div class="row g-3 g-lg-4 mb-4">
              <div class="col-12">
                <h6 class=" border-bottom pb-2">
                  <i class="fas fa-users me-2"></i>
                  Filiação
                </h6>
              </div>

              <div class="col-12 col-md-6">
                <app-text-input label="Nome do Pai" placeholder="Nome completo do pai" formControlName="filiacaoPai" fluid="true"></app-text-input>
              </div>

              <div class="col-12 col-md-6">
                <app-text-input label="Nome da Mãe" placeholder="Nome completo da mãe" formControlName="filiacaoMae" fluid="true"></app-text-input>
              </div>
            </div>

            <!-- Atuação -->
            <div class="row g-3 g-lg-4 mb-4">
              <div class="col-12">
                <h6 class=" border-bottom pb-2">
                  <i class="fas fa-map-marker-alt me-2"></i>
                  Área de Atuação
                </h6>
              </div>
              
              <div class="col-12 col-lg-6">
                <app-select label="Comarcas de Interesse *"
                            formControlName="comarcasIds"
                            [options]="comarcasOptions"
                            [multi]="true"
                            [helperText]="'Selecione uma ou mais comarcas'"
                            ></app-select>
              </div>
              
              <div class="col-12 col-lg-6">
                <app-select label="Áreas de Atuação *"
                            formControlName="areasAtuacaoIds"
                            [options]="areasOptions"
                            [multi]="true"
                            [helperText]="'Selecione uma ou mais áreas'"
                            ></app-select>
              </div>
              
              <div class="col-12">
                <app-text-area label="Disponibilidade" rows="3" autoResize="true" formControlName="disponibilidade" placeholder="Descreva a disponibilidade do agente (dias da semana, horários, etc.)"></app-text-area>
              </div>
            </div>

            <!-- Alertas -->
            <app-alert *ngIf="showSuccess" type="success" [message]="successMessage" [dismissible]="true" (dismissed)="showSuccess=false"></app-alert>
            <app-alert *ngIf="showError" type="danger" [message]="errorMessage" [dismissible]="true" (dismissed)="showError=false"></app-alert>

            <!-- Botões -->
            <div class="row g-3">
              <div class="col-12">
                <div class="d-grid gap-3 d-md-flex justify-content-md-end align-items-md-center">
                  <app-button
                    label="Limpar"
                    type="secondary"
                    iconLeft="fas fa-eraser"
                    (clicked)="limparFormulario()"
                  ></app-button>
                  <app-button
                    [label]="loading ? (isEditMode ? 'Salvando...' : 'Salvando...') : (isEditMode ? 'Atualizar Agente' : 'Cadastrar Agente')"
                    type="primary"
                    buttonType="submit"
                    [disabled]="loading"
                    [iconLeft]="loading ? 'fas fa-spinner fa-spin' : (isEditMode ? 'fas fa-save' : 'fas fa-save')"
                  ></app-button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
