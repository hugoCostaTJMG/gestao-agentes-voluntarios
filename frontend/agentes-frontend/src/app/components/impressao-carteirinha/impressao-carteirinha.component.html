<app-page-header></app-page-header>
<section class="cds-container">

  <app-alert *ngIf="loading && !agente"
             type="info"
             size="md"
             iconLeft="fas fa-spinner fa-spin"
             title="Carregando"
             message="Carregando dados do agente...">
  </app-alert>

  <app-alert *ngIf="error"
             type="danger"
             [dismissible]="true"
             iconLeft="fas fa-exclamation-triangle"
             [message]="error"
             (dismissed)="error = ''">
  </app-alert>

  <div *ngIf="agente && !loading" class="cds-grid">
    <div class="cds-col-8">
      <div class="cds-card">
        <div class="cds-card__header">
          <i class="fas fa-user"></i>
          <h2>Dados do Agente Voluntário</h2>
        </div>
        <div class="cds-card__body">
          <div class="row">
            <div class="col-md-3 text-center mb-3">
              <img [src]="fotoUrl || '/assets/images/foto_padrao.png'" [alt]="agente.nomeCompleto" class="cds-photo">
            </div>
            <div class="col-md-9">
              <div class="row">
                <div class="col-md-12 mb-2">
                  <div class="cds-field">
                    <div class="cds-label">Nome Completo</div>
                    <div class="cds-value">{{ agente.nomeCompleto }}</div>
                  </div>
                </div>
                <div class="col-md-6 mb-2">
                  <div class="cds-field">
                    <div class="cds-label">CPF</div>
                    <div class="cds-value">{{ formatarCPF(agente.cpf) }}</div>
                  </div>
                </div>
                <div class="col-md-6 mb-2">
                  <div class="cds-field">
                    <div class="cds-label">RG</div>
                    <div class="cds-value">{{ agente.numeroCI || 'Não informado' }}</div>
                  </div>
                </div>
                <div class="col-md-6 mb-2">
                  <div class="cds-field">
                    <div class="cds-label">Data de Nascimento</div>
                    <div class="cds-value">{{ formatarData(agente.dataNascimento) }}</div>
                  </div>
                </div>
                <div class="col-md-6 mb-2">
                  <div class="cds-field">
                    <div class="cds-label">Nacionalidade</div>
                    <div class="cds-value">{{ agente.nacionalidade || 'Não informado' }}</div>
                  </div>
                </div>
                <div class="col-md-6 mb-2">
                  <div class="cds-field">
                    <div class="cds-label">Naturalidade</div>
                    <div class="cds-value">{{ agente.naturalidade || 'Não informado' }}</div>
                  </div>
                </div>
                <div class="col-md-6 mb-2">
                  <div class="cds-field">
                    <div class="cds-label">UF</div>
                    <div class="cds-value">{{ agente.uf || 'Não informado' }}</div>
                  </div>
                </div>
                <div class="col-md-12 mb-2">
                  <div class="cds-field">
                    <div class="cds-label">Status</div>
                    <div class="cds-value">
                      <app-badge [text]="getStatusFormatado()" [variant]="getStatusVariant()" tone="soft"></app-badge>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row mt-3" *ngIf="agente.filiacao_mae || agente.filiacao_pai">
            <div class="col-12">
              <div class="cds-section-title">Filiação</div>
              <div *ngIf="agente.filiacao_mae" class="cds-field-inline">
                <div class="cds-label">Mãe</div>
                <div class="cds-value">{{ agente.filiacao_mae }}</div>
              </div>
              <div *ngIf="agente.filiacao_pai" class="cds-field-inline">
                <div class="cds-label">Pai</div>
                <div class="cds-value">{{ agente.filiacao_pai }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="cds-col-4">
      <div class="cds-card">
        <div class="cds-card__header">
          <i class="fas fa-print"></i>
          <h2>Impressão</h2>
        </div>
        <div class="cds-card__body">
          <app-progress-indicator
            [items]="progressItems"
            [currentIndex]="progressCurrent"
            orientation="horizontal"
            size="md"
            [showLabels]="true"
            [clickable]="false"
          ></app-progress-indicator>
          <div style="height: 8px"></div>
          <div class="mb-3">
            <app-alert *ngIf="verificandoStatus" type="info" iconLeft="fas fa-spinner fa-spin" message="Verificando status do agente..."></app-alert>
            <app-alert *ngIf="!verificandoStatus && podeGerar" type="success" iconLeft="fas fa-check-circle" title="Agente apto" message="Carteirinha pode ser gerada"></app-alert>
            <app-alert *ngIf="!verificandoStatus && !podeGerar" type="warning" iconLeft="fas fa-exclamation-triangle" title="Agente não apto" message="Verifique se está ativo e possui credencial válida"></app-alert>
          </div>

          <div class="cds-actions">
            <app-button type="ghost" iconLeft="fas fa-eye" label="Visualizar Preview" [disabled]="!podeGerar || loading" (clicked)="gerarPreview()"></app-button>
            <app-button type="primary" iconLeft="fas fa-download" [loading]="loading" label="Gerar Carteirinha" [disabled]="!podeGerar" (clicked)="gerarCarteirinha()"></app-button>
            <app-button type="tertiary" iconLeft="fas fa-edit" label="Editar Dados" (clicked)="editarAgente()"></app-button>
          </div>

          <div class="cds-section mt-4">
            <div class="cds-section-title muted">Informações</div>
            <ul class="cds-list">
              <li><i class="fas fa-info-circle"></i> A carteirinha será gerada em formato PDF</li>
              <li><i class="fas fa-qrcode"></i> Inclui QR Code para consulta pública</li>
              <li><i class="fas fa-shield-alt"></i> Documento oficial com elementos de segurança</li>
              <li><i class="fas fa-clock"></i> Validade: Tempo indeterminado</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="agente && !loading" class="cds-grid mt-3">
    <div class="cds-col-12">
      <div class="cds-card">
        <div class="cds-card__header">
          <i class="fas fa-info-circle"></i>
          <h2>Sobre a Carteirinha de Agente Voluntário</h2>
        </div>
        <div class="cds-card__body">
          <div class="row">
            <div class="col-md-6">
              <div class="cds-section-title">Frente da Carteirinha</div>
              <ul class="cds-list">
                <li><i class="fas fa-check text-success"></i> Brasão do Poder Judiciário de MG</li>
                <li><i class="fas fa-check text-success"></i> Nome completo do agente</li>
                <li><i class="fas fa-check text-success"></i> Comarca de atuação</li>
                <li><i class="fas fa-check text-success"></i> Fotografia 2x2.5cm</li>
                <li><i class="fas fa-check text-success"></i> Código de controle e versão</li>
                <li><i class="fas fa-check text-success"></i> Assinatura do Juiz de Direito</li>
              </ul>
            </div>
            <div class="col-md-6">
              <div class="cds-section-title">Verso da Carteirinha</div>
              <ul class="cds-list">
                <li><i class="fas fa-check text-success"></i> Carteira de Identidade e UF</li>
                <li><i class="fas fa-check text-success"></i> CPF formatado</li>
                <li><i class="fas fa-check text-success"></i> Nacionalidade e naturalidade</li>
                <li><i class="fas fa-check text-success"></i> Data de nascimento</li>
                <li><i class="fas fa-check text-success"></i> Filiação (pai e mãe)</li>
                <li><i class="fas fa-check text-success"></i> QR Code para consulta</li>
                <li><i class="fas fa-check text-success"></i> Espaço para assinatura</li>
              </ul>
            </div>
          </div>
          <app-alert type="neutral" size="sm" iconLeft="fas fa-gavel" message="Base Legal: Conforme o disposto no art. 362, §1º do Provimento nº 355/2018"></app-alert>
        </div>
      </div>
    </div>
  </div>

</section>

<app-modal [open]="previewOpen" (openChange)="previewOpen = $event" title="Preview da Carteirinha" [size]="'md'">
  <div modal-body>
    <app-carteirinha-preview [agente]="agente"></app-carteirinha-preview>
  </div>
</app-modal>
